æ­¥éª¤ 1ï¼šåœºæ™¯è·¯ç”±å™¨ (Scene Router)
è¿™é‡Œåˆ©ç”¨ä½ ä¹‹å‰çš„ MobileCLIPã€‚ä½ éœ€è¦å‡†å¤‡å¥½è¿™ 5 ä¸ªç±»åˆ«çš„ Prompt å‘é‡ã€‚

å‡†å¤‡æ•°æ®ï¼šåœ¨ action_embeddings.json ä¸­å®šä¹‰å¥½è¿™ 5 ç±»ï¼š

TEXT: "document, book, paper, text, receipt, sign"

SCENERY: "landscape, mountain, sky, nature, sunset"

PERSON: "person, face, man, woman, selfie"

FOOD: "food, dish, meal, restaurant"

OBJECT: "product, bottle, box, item"

è·¯ç”±é€»è¾‘ï¼š

Kotlin

fun analyzeScene(bitmap: Bitmap) {
// 1. MobileCLIP åˆ¤æ–­å±äºå“ªä¸ªåœºæ™¯
val sceneType = semanticMatcher.matchAction(bitmap) // è¿”å› "TEXT", "SCENERY" ç­‰

    // 2. åªæœ‰æ˜¯ TEXT æ—¶æ‰æå–æ–‡å­—å†…å®¹
    if (sceneType == "TEXT") {
        // è°ƒç”¨ OCR æå–æ–‡å­—ï¼Œä¸ºåç»­åŠŸèƒ½åšå‡†å¤‡
        extractTextContent(bitmap) { extractedText ->
            // æ–‡å­—æå–æˆåŠŸåï¼Œå±•ç¤º "æ–‡æœ¬åœºæ™¯å¡ç‰‡"
            showTextActionCard(extractedText)
        }
    } else {
        // å…¶ä»–åœºæ™¯æš‚ç©ºï¼Œæˆ–è€…åªæ˜¾ç¤ºä¸€ä¸ª Toast
        Toast.makeText(this, "è¯†åˆ«ä¸ºï¼š$sceneTypeï¼ŒåŠŸèƒ½å¼€å‘ä¸­...", Toast.LENGTH_SHORT).show()
    }
}
æ­¥éª¤ 2ï¼šå®ç°æ–‡æœ¬åœºæ™¯çš„ä¸‰å¤§åŠŸèƒ½
æ—¢ç„¶ç¡®å®šæ˜¯â€œæ–‡æœ¬ç…§ç‰‡â€ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠæ–‡å­—è¯»å‡ºæ¥ï¼Œæ‰èƒ½åšç¿»è¯‘å’Œæ‰©å†™ã€‚è¿™é‡Œå¿…é¡»é›†æˆ Google ML Kit Text Recognitionï¼ˆå…è´¹ã€ç¦»çº¿ï¼‰ã€‚

ä¾èµ–å¼•å…¥ (build.gradle)ï¼š

Gradle

implementation 'com.google.mlkit:text-recognition:16.0.0'
implementation 'com.google.mlkit:translate:17.0.1' // ç¿»è¯‘ä¹Ÿè¦ç”¨
åŠŸèƒ½ Aï¼šç¿»è¯‘ (Translate) è¿™æ˜¯æœ€èƒ½æ‰“åŠ¨è¯„å§”çš„åŠŸèƒ½ï¼Œä½“ç°â€œæ‰“ç ´è¯­è¨€éšœç¢â€ã€‚

Kotlin

// 1. æå–æ–‡å­— (OCR)
fun extractTextContent(bitmap: Bitmap, callback: (String) -> Unit) {
val image = InputImage.fromBitmap(bitmap, 0)
TextRecognition.getClient(TextRecognizerOptions.DEFAULT_OPTIONS)
.process(image)
.addOnSuccessListener { visionText ->
callback(visionText.text) // æ‹¿åˆ°æ–‡å­—å†…å®¹
}
}

// 2. æ‰§è¡Œç¿»è¯‘
fun performTranslate(originalText: String) {
// æ¯”å¦‚ï¼šè‡ªåŠ¨è¯†åˆ«è¯­è¨€è½¬ä¸­æ–‡
val options = TranslatorOptions.Builder()
.setSourceLanguage(TranslateLanguage.ENGLISH)
.setTargetLanguage(TranslateLanguage.CHINESE)
.build()
val translator = Translation.getClient(options)

    // éœ€è¦å…ˆä¸‹è½½æ¨¡å‹ï¼ˆç¬¬ä¸€æ¬¡ï¼‰
    translator.downloadModelIfNeeded().addOnSuccessListener {
        translator.translate(originalText).addOnSuccessListener { translatedText ->
            // å¼¹çª—æ˜¾ç¤ºç»“æœ
            showResultDialog("ç¿»è¯‘ç»“æœ", translatedText)
        }
    }
}
åŠŸèƒ½ Bï¼šæ”¶è— (Save) è¿™æ˜¯ä½ çš„â€œè®°å¿†â€åŠŸèƒ½ã€‚

Kotlin

// ç®€å•æ•°æ®åº“æ“ä½œ
fun performSave(text: String, bitmap: Bitmap) {
// 1. ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°æ–‡ä»¶
val imagePath = saveBitmapToStorage(bitmap)

    // 2. å­˜å…¥ Room æ•°æ®åº“
    val record = HistoryRecord(
        type = "TEXT",
        content = text,
        imagePath = imagePath,
        timestamp = System.currentTimeMillis()
    )
    database.dao().insert(record)
    Toast.makeText(context, "å·²å½’æ¡£è‡³çµçœ¸è®°å¿†", Toast.LENGTH_SHORT).show()
}
åŠŸèƒ½ Cï¼šæ‰©å†™ (Expand) è¿™æ˜¯â€œAI ç”Ÿæˆâ€åŠŸèƒ½ã€‚ä¸ºäº† PPT æ¼”ç¤ºç¨³å®šï¼Œå»ºè®®ç”¨ Mock (ä¼ªé€ æ•°æ®) æˆ– ç®€å•è§„åˆ™ï¼Œå¦‚æœçœŸè¦æ¥ API å¯èƒ½ä¼šå› ä¸ºç½‘ç»œæ…¢å¯¼è‡´æ¼”ç¤ºç¿»è½¦ã€‚

Kotlin

fun performExpand(text: String) {
// æ¼”ç¤ºç”¨çš„â€œå‡â€AIï¼Œç¡®ä¿æ¯æ¬¡æ¼”ç¤ºéƒ½æˆåŠŸ
// å¦‚æœæƒ³è¦çœŸ AIï¼Œè¿™é‡Œæ¢æˆ OkHttp è¯·æ±‚ DeepSeek/ChatGPT æ¥å£
val expandedText = "ã€AI æ‰©å†™æ€è·¯ã€‘ï¼š\n" +
"1. è¿™æ®µæ–‡å­—çš„æ ¸å¿ƒè§‚ç‚¹æ˜¯... \n" +
"2. æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹è§’åº¦å»¶ä¼¸ï¼š$text... \n" +
"3. æ€»ç»“æ¥è¯´..."

    showResultDialog("AI çµæ„Ÿæ‰©å†™", expandedText)
}
ç¬¬ä¸‰éƒ¨åˆ†ï¼šUI äº¤äº’è®¾è®¡ï¼ˆè®© PPT æ›´å¥½çœ‹ï¼‰
ä½ éœ€è¦è®¾è®¡ä¸€ä¸ª ScenarioCardViewï¼ˆè‡ªå®šä¹‰ View æˆ– Layoutï¼‰ã€‚

å¸ƒå±€æ–‡ä»¶ (layout_action_card.xml)ï¼š

ä¸€ä¸ªåŠé€æ˜èƒŒæ™¯çš„åœ†è§’å¡ç‰‡ã€‚

å·¦è¾¹æ˜¾ç¤ºå›¾æ ‡ï¼ˆæ¯”å¦‚ MobileCLIP è¯†åˆ«å‡ºæ˜¯æ–‡æ¡£ï¼Œæ˜¾ç¤ºğŸ“„ï¼‰ã€‚

å³è¾¹æ¨ªæ’ä¸‰ä¸ªæŒ‰é’®ï¼š[ç¿»è¯‘] [æ”¶è—] [æ‰©å†™]ã€‚

å±•ç¤ºé€»è¾‘ï¼š

ç”¨æˆ·é€‰å›¾ -> handleImageFromGallery

åˆ†æ -> analyzeScene -> ç»“æœæ˜¯ "TEXT"

UI -> binding.cardView.visibility = View.VISIBLEï¼Œå¹¶è®¾ç½®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ã€‚